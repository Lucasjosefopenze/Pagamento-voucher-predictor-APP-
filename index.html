<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>üöÄ Predictor App | Ativa√ß√£o Premium via WhatsApp</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <style>
    :root {
      --primary: #0066FF;
      --primary-dark: #0052D4;
      --secondary: #00D4AA;
      --accent: #FF6B35;
      --success: #00C853;
      --warning: #FFB300;
      --danger: #FF3D00;
      --dark: #121826;
      --light: #FFFFFF;
      --gray-50: #F9FAFB;
      --gray-100: #F3F4F6;
      --gray-200: #E5E7EB;
      --gray-600: #4B5563;
      --gray-800: #1F2937;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.12);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
      --shadow-lg: 0 10px 25px rgba(0,0,0,0.2);
      --radius-sm: 12px;
      --radius-md: 16px;
      --radius-lg: 20px;
      --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 16px;
      color: var(--dark);
      line-height: 1.5;
    }

    /* Container */
    .container {
      max-width: 100%;
      background: var(--light);
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-lg);
      margin: 0 auto;
    }

    /* Header - Chamativo */
    .header {
      background: linear-gradient(135deg, var(--primary), #7C3AED);
      padding: 28px 24px;
      text-align: center;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
      background-size: 30px 30px;
      opacity: 0.3;
      animation: float 20s linear infinite;
    }

    @keyframes float {
      0% { transform: translate(0, 0) rotate(0deg); }
      100% { transform: translate(-30px, -30px) rotate(360deg); }
    }

    .logo-container {
      position: relative;
      z-index: 2;
      margin-bottom: 20px;
    }

    .logo {
      font-size: 28px;
      font-weight: 900;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      letter-spacing: -0.5px;
    }

    .logo-icon {
      background: rgba(255,255,255,0.2);
      width: 50px;
      height: 50px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      padding: 10px 22px;
      border-radius: 50px;
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 16px;
      position: relative;
      z-index: 2;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .header h1 {
      font-size: 28px;
      font-weight: 900;
      margin-bottom: 8px;
      position: relative;
      z-index: 2;
      letter-spacing: -0.5px;
    }

    .subtitle {
      font-size: 16px;
      opacity: 0.95;
      font-weight: 500;
      position: relative;
      z-index: 2;
    }

    /* Price Card - Compacto e Elegante */
    .price-card {
      background: linear-gradient(135deg, var(--secondary), #00B894);
      margin: -20px 24px 24px;
      padding: 22px;
      border-radius: var(--radius-md);
      color: white;
      text-align: center;
      position: relative;
      z-index: 10;
      box-shadow: var(--shadow-md);
      border: 2px solid rgba(255,255,255,0.3);
      backdrop-filter: blur(10px);
    }

    .price-label {
      font-size: 15px;
      font-weight: 600;
      opacity: 0.9;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .price {
      font-size: 44px;
      font-weight: 900;
      margin-bottom: 4px;
      line-height: 1;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .price-period {
      font-size: 16px;
      font-weight: 600;
      opacity: 0.9;
    }

    .benefits {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }

    .benefit {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      opacity: 0.9;
    }

    /* Content */
    .content {
      padding: 0 24px 28px;
    }

    /* WhatsApp Section - Elegante */
    .whatsapp-section {
      background: var(--gray-50);
      padding: 22px;
      border-radius: var(--radius-md);
      margin-bottom: 24px;
      border: 2px solid var(--gray-200);
      position: relative;
    }

    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .section-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #25D366, #128C7E);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--dark);
      flex: 1;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      margin-bottom: 10px;
      font-weight: 700;
      color: var(--gray-800);
      font-size: 15px;
    }

    .input-container {
      position: relative;
    }

    .country-code {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray-600);
      font-weight: 600;
      font-size: 17px;
      pointer-events: none;
    }

    .form-input {
      width: 100%;
      padding: 18px 18px 18px 65px;
      border-radius: 12px;
      border: 2px solid var(--gray-200);
      font-size: 17px;
      font-weight: 600;
      transition: var(--transition);
      background: white;
      color: var(--dark);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 102, 255, 0.1);
    }

    .input-hint {
      font-size: 13px;
      color: var(--gray-600);
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-message {
      padding: 16px;
      border-radius: 12px;
      margin-top: 16px;
      font-weight: 600;
      font-size: 15px;
      display: none;
      animation: slideIn 0.3s ease;
      border-left: 4px solid;
    }

    .status-success {
      background: #E8F5E9;
      color: #2E7D32;
      border-left-color: var(--success);
    }

    .status-error {
      background: #FFEBEE;
      color: #C62828;
      border-left-color: var(--danger);
    }

    /* Warning Box */
    .warning-box {
      background: linear-gradient(135deg, #FFF3CD, #FFEAA7);
      border: 2px solid #FFC107;
      padding: 18px;
      border-radius: var(--radius-sm);
      margin: 20px 0;
      animation: fadeIn 0.5s ease;
    }

    .warning-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .warning-icon {
      color: #FF8C00;
      font-size: 20px;
    }

    .warning-title {
      font-size: 16px;
      font-weight: 800;
      color: #E65100;
    }

    .warning-text {
      font-size: 15px;
      color: #BF360C;
      line-height: 1.5;
    }

    .warning-text strong {
      color: #D84315;
      background: #FFECB3;
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* Payment Methods - Compactos e Elegantes */
    .payment-section {
      margin-bottom: 24px;
    }

    .payment-methods {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .payment-method {
      background: white;
      padding: 20px;
      border-radius: var(--radius-md);
      border: 2px solid var(--gray-200);
      transition: var(--transition);
      position: relative;
    }

    .payment-method.recommended {
      border-color: var(--primary);
      background: linear-gradient(145deg, #F8FAFF, white);
    }

    .method-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 18px;
    }

    .method-icon {
      width: 52px;
      height: 52px;
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 22px;
      flex-shrink: 0;
    }

    .emola .method-icon {
      background: linear-gradient(135deg, #8B5CF6, #7C3AED);
    }

    .mpesa .method-icon {
      background: linear-gradient(135deg, #10B981, #059669);
    }

    .method-info {
      flex: 1;
    }

    .method-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 4px;
    }

    .method-subtitle {
      font-size: 14px;
      color: var(--gray-600);
      font-weight: 500;
    }

    .method-details {
      background: var(--gray-50);
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 18px;
      border: 1px solid var(--gray-200);
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid var(--gray-200);
    }

    .detail-item:last-child {
      border-bottom: none;
      padding-top: 12px;
      margin-top: 4px;
    }

    .detail-label {
      font-size: 15px;
      color: var(--gray-800);
      font-weight: 600;
    }

    .detail-value {
      font-size: 20px;
      font-weight: 900;
      color: var(--primary);
      font-family: 'Courier New', monospace;
      letter-spacing: 0.5px;
    }

    .account-holder {
      font-size: 16px;
      font-weight: 700;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .copy-button {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .copy-button:disabled {
      background: var(--gray-200);
      color: var(--gray-600);
      cursor: not-allowed;
      opacity: 0.7;
    }

    .copy-button:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 102, 255, 0.3);
    }

    .copy-button.copied {
      background: linear-gradient(135deg, var(--success), #00B894);
    }

    /* Confirma√ß√£o de Pagamento - Estilos Revisados */
    .confirmation-box {
      background: var(--gray-50);
      padding: 20px;
      border-radius: var(--radius-md);
      border: 2px solid var(--gray-200);
    }

    .method-selection {
      display: flex;
      gap: 12px;
      margin-bottom: 8px;
    }

    .method-option {
      flex: 1;
      background: white;
      border: 2px solid var(--gray-200);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .method-option:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    .method-option.selected {
      border-color: var(--primary);
      background: linear-gradient(145deg, #F8FAFF, white);
      box-shadow: 0 4px 12px rgba(0, 102, 255, 0.1);
    }

    .method-option-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 10px;
      font-size: 18px;
      color: white;
    }

    #methodEmola .method-option-icon {
      background: linear-gradient(135deg, #8B5CF6, #7C3AED);
    }

    #methodMpesa .method-option-icon {
      background: linear-gradient(135deg, #10B981, #059669);
    }

    .method-option-text {
      font-weight: 700;
      font-size: 15px;
      color: var(--dark);
    }

    textarea.form-input {
      font-family: 'Courier New', Courier, monospace;
      min-height: 140px;
    }

    /* Support Section - Elegante */
    .support-section {
      background: linear-gradient(135deg, var(--dark), #1E293B);
      color: white;
      padding: 24px;
      border-radius: var(--radius-md);
      text-align: center;
      margin-top: 24px;
      position: relative;
      overflow: hidden;
    }

    .support-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
    }

    .support-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .support-desc {
      font-size: 15px;
      color: #CBD5E1;
      margin-bottom: 20px;
      line-height: 1.6;
    }

    .support-number {
      font-size: 24px;
      font-weight: 900;
      color: #38BDF8;
      margin: 12px 0;
      direction: ltr;
      letter-spacing: 0.5px;
    }

    .support-button {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: rgba(56, 189, 248, 0.15);
      color: #38BDF8;
      padding: 14px 24px;
      border-radius: 12px;
      font-weight: 700;
      text-decoration: none;
      font-size: 15px;
      border: 2px solid rgba(56, 189, 248, 0.25);
      transition: var(--transition);
      margin-top: 8px;
    }

    .support-button:hover {
      background: rgba(56, 189, 248, 0.25);
      transform: translateY(-2px);
    }

    .support-hours {
      font-size: 14px;
      color: #94A3B8;
      margin-top: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    /* Footer */
    .footer {
      padding: 24px;
      text-align: center;
      background: var(--gray-50);
      border-top: 2px solid var(--gray-200);
    }

    .security-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .security-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      padding: 12px;
      background: white;
      border-radius: 10px;
      border: 1px solid var(--gray-200);
    }

    .security-icon {
      font-size: 20px;
    }

    .security-text {
      font-size: 12px;
      font-weight: 600;
      color: var(--gray-800);
      text-align: center;
      line-height: 1.3;
    }

    .copyright {
      font-size: 13px;
      color: var(--gray-600);
      margin-top: 12px;
      font-weight: 500;
    }

    /* Toast */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      color: var(--dark);
      padding: 16px 20px;
      border-radius: 12px;
      font-weight: 700;
      display: none;
      z-index: 1000;
      box-shadow: var(--shadow-lg);
      border-left: 4px solid;
      max-width: 90%;
      text-align: center;
      animation: slideDown 0.3s ease;
    }

    /* Debug Panel - INVIS√çVEL */
    .debug-panel {
      display: none !important; /* Mant√©m invis√≠vel */
      background: #f8f9fa;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      padding: 15px;
      margin: 15px 0;
      font-family: monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }

    .debug-title {
      font-weight: bold;
      color: #495057;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .debug-button {
      background: #6c757d;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
    }

    .debug-button:hover {
      background: #5a6268;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }

    .modal-content {
      background: white;
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 420px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-lg);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .modal-header {
      padding: 24px 24px 16px;
      position: relative;
      text-align: center;
    }

    .modal-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 28px;
    }

    .modal-icon.success {
      background: linear-gradient(135deg, var(--success), #00B894);
      color: white;
    }

    .modal-header h3 {
      font-size: 20px;
      font-weight: 900;
      color: var(--dark);
      margin-bottom: 8px;
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: none;
      border: none;
      color: var(--gray-600);
      cursor: pointer;
      font-size: 18px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .modal-close:hover {
      background: var(--gray-100);
    }

    .modal-body {
      padding: 0 24px 24px;
    }

    .confirmation-message {
      background: var(--gray-50);
      border-radius: var(--radius-sm);
      padding: 16px;
      margin-bottom: 16px;
    }

    .confirmation-item {
      display: flex;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--gray-200);
    }

    .confirmation-item:last-child {
      border-bottom: none;
    }

    .confirmation-item i {
      font-size: 20px;
      color: var(--primary);
      margin-top: 2px;
    }

    .confirmation-item strong {
      display: block;
      font-size: 15px;
      color: var(--dark);
      margin-bottom: 4px;
    }

    .confirmation-item p {
      font-size: 14px;
      color: var(--gray-600);
      margin: 0;
    }

    .modal-warning {
      background: #FFF3CD;
      border: 1px solid #FFC107;
      border-radius: 10px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: #856404;
    }

    .modal-warning i {
      color: #FFC107;
    }

    .modal-footer {
      padding: 16px 24px 24px;
      border-top: 1px solid var(--gray-200);
    }

    .modal-button {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .modal-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 102, 255, 0.3);
    }

    /* Animations */
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translate(-50%, -20px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (min-width: 480px) {
      .container {
        max-width: 420px;
        margin: 20px auto;
      }
    }

    /* Utility */
    .hidden {
      display: none !important;
    }

    .shake {
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    /* Requirements Box */
    .requirements-box {
      display: flex;
      gap: 16px;
      margin: 16px 0;
      padding: 12px;
      background: var(--gray-100);
      border-radius: 10px;
    }
    
    .requirement-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 600;
    }
    
    .requirement-item i.valid {
      color: var(--success);
    }
    
    .requirement-item i.invalid {
      color: var(--gray-300);
    }
  </style>
</head>

<body>

<!-- Toast -->
<div class="toast" id="toast">
  <div style="display: flex; align-items: center; gap: 10px;">
    <i class="fas fa-check-circle" id="toastIcon"></i>
    <span id="toastMessage">Copiado com sucesso!</span>
  </div>
</div>

<div class="container">

  <!-- Header -->
  <div class="header">
    <div class="logo-container">
      <div class="logo">
        <div class="logo-icon">
          <i class="fas fa-bolt"></i>
        </div>
        <span>VOUCHER-PAY</span>
      </div>
    </div>
    
    <div class="badge">
      <i class="fas fa-shield-alt"></i>
      PAGAMENTO 100% SEGURO
    </div>
    
    <h1>ATIVA√á√ÉO PREMIUM</h1>
    <p class="subtitle">Receba o c√≥digo via WhatsApp</p>
  </div>

  <!-- Price Card -->
  <div class="price-card">
    <div class="price-label">Valor Total</div>
    <div class="price">659 MT</div>
    <div class="price-period">Acesso por 48 Horas</div>
    
    <div class="benefits">
      <div class="benefit">
        <i class="fas fa-check"></i>
        <span>Acesso Imediato</span>
      </div>
      <div class="benefit">
        <i class="fas fa-headset"></i>
        <span>Suporte 24/7</span>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="content">

    <!-- WhatsApp Section -->
    <div class="whatsapp-section">
      <div class="section-header">
        <div class="section-icon">
          <i class="fab fa-whatsapp"></i>
        </div>
        <div class="section-title">Digite seu WhatsApp</div>
      </div>
      
      <div class="form-group">
        <label class="form-label">N√∫mero para receber o Voucher:</label>
        <div class="input-container">
          <span class="country-code">+258</span>
          <input type="tel" 
                 id="whatsapp" 
                 class="form-input" 
                 placeholder="84 123 456" 
                 maxlength="13"
                 inputmode="numeric"
                 autocomplete="tel"
                 required>
        </div>
        <div class="input-hint">
          <i class="fas fa-info-circle"></i>
          Digite 9 d√≠gitos (ex: 84xxxxxxx)
        </div>
      </div>
      
      <!-- Status Messages -->
      <div class="status-message status-success" id="successMessage">
        <i class="fas fa-check-circle"></i>
        WhatsApp registrado! Pronto para pagamento.
      </div>
      
      <div class="status-message status-error" id="errorMessage">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorText">Digite 9 d√≠gitos v√°lidos</span>
      </div>
    </div>

    <!-- Warning Box -->
    <div class="warning-box">
      <div class="warning-header">
        <i class="fas fa-exclamation-triangle warning-icon"></i>
        <div class="warning-title">INSTRU√á√ÉO IMPORTANTE</div>
      </div>
      <div class="warning-text">
        Ao fazer o pagamento, <strong>VERIFIQUE O NOME: LUCAS JOS√â</strong> para confirma√ß√£o. 
        O c√≥digo ser√° enviado em 5min ap√≥s pagamento confirmado.
      </div>
    </div>

    <!-- Payment Methods -->
    <div class="payment-section">
      <div class="section-header">
        <div class="section-icon" style="background: linear-gradient(135deg, var(--primary), #4F46E5);">
          <i class="fas fa-credit-card"></i>
        </div>
        <div class="section-title">M√©todo de Pagamento</div>
      </div>
      
      <div class="payment-methods">
        
        <!-- eMola -->
        <div class="payment-method emola recommended">
          <div class="method-header">
            <div class="method-icon">
              <i class="fas fa-wallet"></i>
            </div>
            <div class="method-info">
              <div class="method-title">eMOLA</div>
              <div class="method-subtitle">Mais Usado ‚Ä¢ Recomendado</div>
            </div>
          </div>
          
          <div class="method-details">
            <div class="detail-item">
              <span class="detail-label">N√∫mero:</span>
              <span class="detail-value">866890298</span>
            </div>
            <div class="detail-item">
              <span class="account-holder">
                <i class="fas fa-user-check"></i>
                Titular: <span style="color: var(--primary);">LUCAS JOS√â</span>
              </span>
            </div>
          </div>
          
          <button class="copy-button" id="emolaBtn" onclick="copyNumber('866890298', this, 'eMola')" disabled>
            <span class="btn-text">COPIAR N√öMERO</span>
            <span class="spinner hidden"></span>
          </button>
        </div>

        <!-- M-Pesa -->
        <div class="payment-method mpesa">
          <div class="method-header">
            <div class="method-icon">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="method-info">
              <div class="method-title">M-PESA</div>
              <div class="method-subtitle">Alternativa ‚Ä¢ Seguro</div>
            </div>
          </div>
          
          <div class="method-details">
            <div class="detail-item">
              <span class="detail-label">N√∫mero:</span>
              <span class="detail-value">848750886</span>
            </div>
            <div class="detail-item">
              <span class="account-holder">
                <i class="fas fa-user-check"></i>
                Titular: <span style="color: var(--primary);">LUCAS JOS√â</span>
              </span>
            </div>
          </div>
          
          <button class="copy-button" id="mpesaBtn" onclick="copyNumber('848750886', this, 'M-Pesa')" disabled>
            <span class="btn-text">COPIAR N√öMERO</span>
            <span class="spinner hidden"></span>
          </button>
        </div>
      </div>
    </div>

    <!-- Confirma√ß√£o de Pagamento - APENAS MENSAGEM -->
    <div class="payment-section" id="paymentConfirmationSection">
      <div class="section-header">
        <div class="section-icon" style="background: linear-gradient(135deg, var(--success), #00B894);">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="section-title">Enviar Confirma√ß√£o de Pagamento</div>
      </div>
      
      <div class="confirmation-box">
        <!-- Sele√ß√£o do M√©todo -->
        <div class="form-group">
          <label class="form-label">M√©todo utilizado:</label>
          <div class="method-selection">
            <div class="method-option" onclick="selectPaymentMethod('emola')" id="methodEmola">
              <div class="method-option-icon">
                <i class="fas fa-wallet"></i>
              </div>
              <div class="method-option-text">eMola</div>
            </div>
            <div class="method-option" onclick="selectPaymentMethod('mpesa')" id="methodMpesa">
              <div class="method-option-icon">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="method-option-text">M-Pesa</div>
            </div>
          </div>
          <div class="input-hint">
            <i class="fas fa-info-circle"></i>
            Selecione o m√©todo que usou para pagar
          </div>
          <input type="hidden" id="selectedMethod" value="">
        </div>
        
        <!-- Campo para Mensagem/ID da Transa√ß√£o -->
        <div class="form-group">
          <label class="form-label">Mensagem de Confirma√ß√£o / ID da Transa√ß√£o:</label>
          <textarea id="transactionMessage" 
                    class="form-input" 
                    rows="4"
                    placeholder="Cole aqui a MENSAGEM COMPLETA de confirma√ß√£o que recebeu ap√≥s o pagamento..."
                    oninput="validateConfirmationForm()"
                    style="padding: 16px; resize: vertical; min-height: 120px; font-family: monospace; font-size: 14px;"></textarea>
          <div class="input-hint">
            <i class="fas fa-info-circle"></i>
            <span id="charCount">0/100 caracteres m√≠nimos</span>
            ‚Ä¢ Cole a mensagem completa recebida ap√≥s o pagamento
          </div>
        </div>
        
        <!-- Requisitos -->
        <div class="requirements-box">
          <div class="requirement-item">
            <i class="fas fa-check-circle" id="methodCheck"></i>
            <span>M√©todo selecionado</span>
          </div>
          <div class="requirement-item">
            <i class="fas fa-check-circle" id="messageCheck"></i>
            <span>Mensagem (Colada)</span>
          </div>
        </div>
        
        <button class="copy-button" id="submitPaymentBtn" onclick="submitPaymentConfirmation()" disabled>
          <i class="fas fa-paper-plane"></i>
          <span class="btn-text">ENVIAR CONFIRMA√á√ÉO</span>
          <span class="spinner hidden"></span>
        </button>
      </div>
    </div>

    <!-- Support Section -->
    <div class="support-section">
      <div class="support-title">
        <i class="fas fa-headset"></i>
        PRECISA DE AJUDA?
      </div>
      <div class="support-desc">
        Problemas com pagamento ou n√£o recebeu o c√≥digo? 
        Fale diretamente com nosso suporte Via WhatsApp.
      </div>
      <div class="support-number">+258 866 890 298</div>
      <button class="support-button" onclick="copySupportNumber()">
        <i class="fas fa-copy"></i>
        COPIAR N√öMERO DO SUPORTE
      </button>
      <div class="support-hours">
        <i class="far fa-clock"></i>
        Atendimento: 8h √†s 22h
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="security-grid">
      <div class="security-item">
        <i class="fas fa-lock security-icon" style="color: var(--success);"></i>
        <div class="security-text">Pagamento Seguro</div>
      </div>
      <div class="security-item">
        <i class="fas fa-bolt security-icon" style="color: var(--warning);"></i>
        <div class="security-text">Entrega Instant√¢nea</div>
      </div>
      <div class="security-item">
        <i class="fas fa-shield-alt security-icon" style="color: var(--primary);"></i>
        <div class="security-text">Garantia Total</div>
      </div>
    </div>
    <div class="copyright">
      ¬© 2025 EllonMusk‚Ä¢
    </div>
  </div>
</div>

<!-- Modal de Confirma√ß√£o -->
<div class="modal-overlay" id="confirmationModal" style="display: none;">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-icon success">
        <i class="fas fa-check-circle"></i>
      </div>
      <h3>‚úÖ Confirma√ß√£o Enviada!</h3>
      <button class="modal-close" onclick="closeModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="confirmation-message">
        <div class="confirmation-item">
          <i class="fas fa-clock"></i>
          <div>
            <strong>‚è≥ Aguarde a verifica√ß√£o</strong>
            <p>Processaremos seu pagamento em at√© 5 minutos</p>
          </div>
        </div>
        
        <div class="confirmation-item">
          <i class="fab fa-whatsapp"></i>
          <div>
            <strong>üì≤ Ser√° notificado no WhatsApp</strong>
            <p>Enviaremos o voucher assim que confirmado</p>
          </div>
        </div>
        
        <div class="confirmation-item">
          <i class="fas fa-mobile-alt"></i>
          <div>
            <strong>üìû N√∫mero registrado:</strong>
            <p id="modalWhatsappNumber">+258xxxxxxxx</p>
          </div>
        </div>
        
        <div class="confirmation-item">
          <i class="fas fa-receipt"></i>
          <div>
            <strong>üìÑ ID da Transa√ß√£o:</strong>
            <p id="modalTransactionId">N√£o identificado</p>
          </div>
        </div>
      </div>
      
      <div class="modal-warning">
        <i class="fas fa-exclamation-circle"></i>
        <span>Aguarde a nossa Notifica√ß√£o no whatsApp</span>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="modal-button" onclick="closeModal()">
        <i class="fas fa-check"></i>
        ENTENDIDO
      </button>
    </div>
  </div>
</div>

<script>
  // ==================== CONFIGURA√á√ÉO DO SISTEMA ====================
  const STORAGE_KEY_WHATSAPP = 'predictor_whatsapp_mobile';
  const STORAGE_KEY_LOGS = 'predictor_registration_logs';
  const STORAGE_KEY_COPY_LOGS = 'predictor_copy_logs';
  const STORAGE_KEY_PAYMENTS = 'predictor_payment_confirmations';
  const STORAGE_KEY_SITE_VISITS = 'payment_site_visits_log';
  const STORAGE_KEY_SESSION = 'payment_site_session';
  
  // ==================== VARI√ÅVEIS GLOBAIS ====================
  const whatsappInput = document.getElementById('whatsapp');
  const successMessage = document.getElementById('successMessage');
  const errorMessage = document.getElementById('errorMessage');
  const errorText = document.getElementById('errorText');
  const toast = document.getElementById('toast');
  const toastMessage = document.getElementById('toastMessage');
  const toastIcon = document.getElementById('toastIcon');
  const emolaBtn = document.getElementById('emolaBtn');
  const mpesaBtn = document.getElementById('mpesaBtn');
  
  // Vari√°veis para Confirma√ß√£o
  const transactionMessageInput = document.getElementById('transactionMessage');
  const submitPaymentBtn = document.getElementById('submitPaymentBtn');
  const charCount = document.getElementById('charCount');
  const selectedMethodInput = document.getElementById('selectedMethod');
  const confirmationModal = document.getElementById('confirmationModal');
  const modalWhatsappNumber = document.getElementById('modalWhatsappNumber');
  const modalTransactionId = document.getElementById('modalTransactionId');
  
  // Elementos de verifica√ß√£o
  const methodCheck = document.getElementById('methodCheck');
  const messageCheck = document.getElementById('messageCheck');
  
  let isWhatsappValid = false;
  let currentWhatsappNumber = '';
  let firebaseAvailable = false;
  let selectedPaymentMethod = '';
  let currentSessionId = generateSessionId();

  // ==================== GERAR ID DE SESS√ÉO ====================
  function generateSessionId() {
    return 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
  }

  // ==================== INICIALIZAR FIREBASE ====================
  function initializeFirebase() {
    try {
      if (typeof firebase !== 'undefined') {
        const firebaseConfig = {
          apiKey: "AIzaSyDbPB6XBF3J1VY0X0ZQj2SKu8",
          authDomain: "whatsapp-24492.firebaseapp.com",
          projectId: "whatsapp-24492",
          storageBucket: "whatsapp-24492.appspot.com",
          messagingSenderId: "5299709394245",
          appId: "1:5299709394245:web:7d46554&c2e",
          measurementId: "G-FAKLLOK27H"
        };
        
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        firebaseAvailable = true;
        console.log('‚úÖ Firebase dispon√≠vel para o site de pagamento');
      }
    } catch (error) {
      console.warn('‚ö†Ô∏è Firebase n√£o dispon√≠vel no Sketchiware, usando localStorage');
      firebaseAvailable = false;
    }
  }

  // ==================== VERIFICAR SE DEVE REGISTRAR VISITA ====================
  function shouldRegisterVisit() {
    try {
      const lastVisit = localStorage.getItem('last_site_visit');
      const now = Date.now();
      
      // Se nunca visitou ou visitou h√° mais de 30 minutos, registra
      if (!lastVisit || (now - parseInt(lastVisit)) > (30 * 60 * 1000)) {
        return true;
      }
      
      return false;
    } catch (error) {
      return true; // Em caso de erro, registra
    }
  }

  // ==================== REGISTRAR VISITA DO SITE ====================
  function registerSiteVisit() {
    if (!firebaseAvailable) {
      console.log('‚ö†Ô∏è Firebase n√£o dispon√≠vel, salvando visita localmente');
      saveSiteVisitLocally();
      return;
    }
    
    try {
      // Dados da visita
      const visitData = {
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        userAgent: navigator.userAgent,
        referrer: document.referrer || 'direct',
        url: window.location.href,
        pageType: 'predictor_mobile_premium_payment',
        screenWidth: window.innerWidth,
        screenHeight: window.innerHeight,
        language: navigator.language,
        platform: navigator.platform,
        
        // IDENTIFICADORES EXCLUSIVOS DO SITE DE PAGAMENTO
        isPaymentSite: true,
        isAdminPanel: false,
        siteType: 'payment_site',
        visitSource: 'predictor_payment_page',
        
        // Informa√ß√µes de sess√£o
        sessionId: currentSessionId,
        isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
        hasTouch: 'ontouchstart' in window,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        
        // Informa√ß√µes da visita
        pageLoaded: true,
        visitType: 'page_visit',
        paymentAmount: '659 MT',
        currency: 'MT'
      };
      
      // Registrar visita no Firebase
      firebase.firestore().collection('payment_site_visits').add(visitData)
        .then((docRef) => {
          console.log('‚úÖ Visita registrada com ID:', docRef.id);
          
          // Salvar localmente que registrou
          localStorage.setItem('last_site_visit', Date.now().toString());
          localStorage.setItem('last_session_id', currentSessionId);
        })
        .catch(error => {
          console.warn('‚ö†Ô∏è Erro ao registrar visita no Firebase, salvando localmente:', error);
          saveSiteVisitLocally(visitData);
        });
    } catch (error) {
      console.warn('‚ö†Ô∏è Erro ao registrar visita:', error);
      saveSiteVisitLocally();
    }
  }

  // ==================== SALVAR VISITA LOCALMENTE (FALLBACK) ====================
  function saveSiteVisitLocally(visitData = null) {
    try {
      const visits = JSON.parse(localStorage.getItem(STORAGE_KEY_SITE_VISITS) || '[]');
      
      const visit = visitData || {
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        url: window.location.href,
        pageType: 'predictor_mobile_premium_payment',
        sessionId: currentSessionId,
        storedLocally: true
      };
      
      visits.push(visit);
      
      // Manter apenas os √∫ltimos 50 registros
      if (visits.length > 50) {
        visits.splice(0, visits.length - 50);
      }
      
      localStorage.setItem(STORAGE_KEY_SITE_VISITS, JSON.stringify(visits));
      localStorage.setItem('last_site_visit', Date.now().toString());
      
      console.log('üìä Visita salva localmente');
    } catch (error) {
      console.error('‚ùå Erro ao salvar visita localmente:', error);
    }
  }

  // ==================== REGISTRAR A√á√ÉO DO USU√ÅRIO ====================
  function registerUserAction(action, details = {}) {
    if (!firebaseAvailable) return;
    
    try {
      const actionData = {
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        sessionId: currentSessionId,
        action: action,
        ...details,
        userAgent: navigator.userAgent,
        url: window.location.href
      };
      
      firebase.firestore().collection('user_actions').add(actionData)
        .then(() => {
          console.log(`‚úÖ A√ß√£o registrada: ${action}`);
        })
        .catch(error => {
          console.warn(`‚ö†Ô∏è Erro ao registrar a√ß√£o ${action}:`, error);
        });
    } catch (error) {
      console.warn(`‚ö†Ô∏è Erro ao registrar a√ß√£o:`, error);
    }
  }

  // ==================== INICIALIZA√á√ÉO DA APLICA√á√ÉO ====================
  document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ Predictor Payment Site iniciando...');
    console.log('üì± Sess√£o ID:', currentSessionId);
    
    // Inicializar Firebase (se dispon√≠vel)
    initializeFirebase();
    
    // REGISTRAR VISITA IMEDIATAMENTE AO CARREGAR A P√ÅGINA
    if (shouldRegisterVisit()) {
      console.log('üë£ Registrando nova visita...');
      registerSiteVisit();
    } else {
      console.log('‚è±Ô∏è Visita j√° registrada recentemente');
    }
    
    // Registrar evento de carregamento da p√°gina
    registerUserAction('page_load', {
      pageType: 'payment_page',
      loadTime: performance.now()
    });
    
    // Carregar n√∫mero salvo
    const saved = getSavedWhatsapp();
    if (saved) {
      whatsappInput.value = formatPhoneNumber(saved);
      validateWhatsappNumber(true);
    }
    
    // Configurar valida√ß√£o em tempo real
    whatsappInput.addEventListener('input', function() {
      let value = this.value.replace(/\D/g, '');
      
      if (value.length > 9) {
        value = value.substring(0, 9);
      }
      
      this.value = formatPhoneNumber(value);
      validateWhatsappNumber();
      
      // Registrar a√ß√£o de digita√ß√£o
      if (value.length > 0) {
        registerUserAction('whatsapp_input', {
          inputLength: value.length,
          prefix: value.substring(0, 2)
        });
      }
    });
    
    // Validar ao perder foco
    whatsappInput.addEventListener('blur', function() {
      validateWhatsappNumber(true);
    });
    
    // Registrar clique nos campos
    whatsappInput.addEventListener('focus', function() {
      registerUserAction('field_focus', { field: 'whatsapp' });
    });
    
    // Registrar visualiza√ß√£o dos m√©todos de pagamento
    const paymentMethods = document.querySelectorAll('.payment-method');
    paymentMethods.forEach(method => {
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const methodName = method.classList.contains('emola') ? 'eMola' : 'M-Pesa';
            registerUserAction('payment_method_view', { method: methodName });
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.5 });
      
      observer.observe(method);
    });
    
    // Atualizar contador de caracteres
    transactionMessageInput.addEventListener('input', function() {
      const length = this.value.length;
      charCount.textContent = `${length}/100 caracteres m√≠nimos`;
      
      // Mudar cor conforme atinge o m√≠nimo
      if (length >= 100) {
        charCount.style.color = 'var(--success)';
        charCount.style.fontWeight = '700';
      } else {
        charCount.style.color = 'var(--danger)';
        charCount.style.fontWeight = '600';
      }
      
      validateConfirmationForm();
    });
    
    // Focar no campo
    setTimeout(() => whatsappInput.focus(), 400);
    
    // Registrar tempo na p√°gina
    window.addEventListener('beforeunload', function() {
      const timeOnPage = Math.round(performance.now() / 1000);
      registerUserAction('page_exit', {
        timeOnPage: timeOnPage,
        whatsappEntered: isWhatsappValid,
        currentPage: 'payment_page'
      });
    });
    
    console.log('‚úÖ Predictor Payment Site carregado!');
  });

  // ==================== FORMATAR N√öMERO ====================
  function formatPhoneNumber(number) {
    if (!number) return '';
    const cleaned = number.replace(/\D/g, '');
    const match = cleaned.match(/^(\d{2})(\d{3})(\d{0,4})$/);
    if (match) {
      return match[1] + ' ' + match[2] + (match[3] ? ' ' + match[3] : '');
    }
    return cleaned;
  }

  // ==================== SALVAR NO LOCALSTORAGE ====================
  function saveToLocalStorage(phoneNumber, action = 'registration') {
    try {
      const timestamp = new Date().toISOString();
      
      // Salvar WhatsApp
      localStorage.setItem(STORAGE_KEY_WHATSAPP, phoneNumber);
      
      // Salvar no log de registros
      const logs = JSON.parse(localStorage.getItem(STORAGE_KEY_LOGS) || '[]');
      logs.push({
        phoneNumber: phoneNumber,
        action: action,
        timestamp: timestamp,
        amount: '659 MT',
        page: 'predictor_mobile_premium',
        source: 'sketchiware',
        sessionId: currentSessionId
      });
      
      // Manter apenas os √∫ltimos 50 registros
      if (logs.length > 50) {
        logs.splice(0, logs.length - 50);
      }
      
      localStorage.setItem(STORAGE_KEY_LOGS, JSON.stringify(logs));
      
      console.log('üì± Dados salvos localmente:', phoneNumber);
      return true;
    } catch (error) {
      console.error('‚ùå Erro ao salvar localmente:', error);
      return false;
    }
  }

  // ==================== OBTER WHATSAPP SALVO ====================
  function getSavedWhatsapp() {
    try {
      return localStorage.getItem(STORAGE_KEY_WHATSAPP);
    } catch (error) {
      console.error('‚ùå Erro ao ler localStorage:', error);
      return null;
    }
  }

  // ==================== VALIDAR WHATSAPP ====================
  function validateWhatsappNumber(save = false) {
    const rawNumber = whatsappInput.value.replace(/\s/g, '');
    
    // Resetar mensagens
    successMessage.style.display = 'none';
    errorMessage.style.display = 'none';
    
    // Verificar se est√° vazio
    if (!rawNumber) {
      isWhatsappValid = false;
      updateCopyButtons();
      validateConfirmationForm();
      return false;
    }
    
    // Verificar se tem 9 d√≠gitos
    if (rawNumber.length !== 9) {
      showError('Digite exatamente 9 d√≠gitos');
      isWhatsappValid = false;
      updateCopyButtons();
      validateConfirmationForm();
      return false;
    }
    
    // Verificar prefixo v√°lido
    const validPrefixes = ['82', '83', '84', '85', '86', '87'];
    const prefix = rawNumber.substring(0, 2);
    if (!validPrefixes.includes(prefix)) {
      showError('Use prefixo 82, 83, 84, 85, 86 ou 87');
      isWhatsappValid = false;
      updateCopyButtons();
      validateConfirmationForm();
      return false;
    }
    
    // N√∫mero v√°lido
    currentWhatsappNumber = rawNumber;
    isWhatsappValid = true;
    
    // Salvar localmente
    saveToLocalStorage(rawNumber, 'whatsapp_validation');
    
    // Registrar a√ß√£o no Firebase
    registerUserAction('whatsapp_validated', {
      phoneNumber: rawNumber,
      isValid: true
    });
    
    // Atualizar bot√µes
    updateCopyButtons();
    validateConfirmationForm();
    
    // Mostrar sucesso
    successMessage.style.display = 'block';
    
    // Salvar no Firebase se dispon√≠vel
    if (save && firebaseAvailable) {
      try {
        firebase.firestore().collection('whatsapp_numbers').add({
          phoneNumber: rawNumber,
          status: 'pending',
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          amount: '659 MT',
          page: 'predictor_mobile_premium',
          userAgent: navigator.userAgent,
          source: 'sketchiware',
          sessionId: currentSessionId
        });
        console.log('‚úÖ Dados enviados para Firebase');
      } catch (error) {
        console.warn('‚ö†Ô∏è Firebase falhou, mantendo apenas local');
      }
    }
    
    return true;
  }

  // ==================== ATUALIZAR BOT√ïES ====================
  function updateCopyButtons() {
    if (isWhatsappValid) {
      emolaBtn.disabled = false;
      mpesaBtn.disabled = false;
      console.log('‚úÖ Bot√µes habilitados');
    } else {
      emolaBtn.disabled = true;
      mpesaBtn.disabled = true;
      console.log('‚ùå Bot√µes desabilitados');
    }
  }

  // ==================== MOSTRAR ERRO ====================
  function showError(message) {
    errorText.textContent = message;
    errorMessage.style.display = 'block';
    successMessage.style.display = 'none';
    
    // Registrar erro
    registerUserAction('validation_error', {
      field: 'whatsapp',
      error: message
    });
    
    // Anima√ß√£o de shake
    whatsappInput.classList.add('shake');
    setTimeout(() => {
      whatsappInput.classList.remove('shake');
    }, 500);
  }

  // ==================== FUN√á√ÉO DE C√ìPIA ====================
  async function copyNumber(number, button, method) {
    // Verificar WhatsApp
    if (!isWhatsappValid) {
      showToast('Digite seu WhatsApp primeiro!', 'error');
      whatsappInput.focus();
      return;
    }
    
    const btnText = button.querySelector('.btn-text');
    const spinner = button.querySelector('.spinner');
    const originalText = btnText.textContent;
    
    btnText.textContent = 'COPIANDO...';
    spinner.classList.remove('hidden');
    button.disabled = true;
    
    // Registrar in√≠cio da c√≥pia
    registerUserAction('copy_started', {
      method: method,
      number: number,
      whatsapp: currentWhatsappNumber
    });
    
    try {
      // Copiar para √°rea de transfer√™ncia
      await navigator.clipboard.writeText(number);
      
      // Registrar a√ß√£o localmente
      logCopyActionLocally(number, method);
      
      // Registrar c√≥pia bem-sucedida
      registerUserAction('copy_success', {
        method: method,
        number: number,
        whatsapp: currentWhatsappNumber
      });
      
      // Mostrar toast
      showToast(`‚úÖ ${method} copiado! Nome: LUCAS JOS√â`, 'success');
      
      // Atualizar bot√£o
      btnText.textContent = 'COPIADO!';
      button.classList.add('copied');
      spinner.classList.add('hidden');
      
      // Restaurar ap√≥s 1.5s
      setTimeout(() => {
        btnText.textContent = originalText;
        button.classList.remove('copied');
        button.disabled = false;
      }, 1500);
      
    } catch (error) {
      console.error('Erro ao copiar:', error);
      
      // Registrar erro na c√≥pia
      registerUserAction('copy_error', {
        method: method,
        error: error.message,
        whatsapp: currentWhatsappNumber
      });
      
      // Fallback para input tempor√°rio
      try {
        const tempInput = document.createElement('input');
        tempInput.value = number;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        
        showToast(`‚úÖ ${method} copiado! Nome: LUCAS JOS√â`, 'success');
        logCopyActionLocally(number, method);
        
        // Registrar fallback bem-sucedido
        registerUserAction('copy_fallback_success', {
          method: method,
          number: number
        });
      } catch (fallbackError) {
        showToast('‚ùå Erro ao copiar', 'error');
      }
      
      btnText.textContent = originalText;
      spinner.classList.add('hidden');
      button.disabled = false;
    }
  }

  // ==================== LOGAR A√á√ÉO LOCALMENTE ====================
  function logCopyActionLocally(number, method) {
    try {
      const timestamp = new Date().toISOString();
      const copyLogs = JSON.parse(localStorage.getItem(STORAGE_KEY_COPY_LOGS) || '[]');
      
      copyLogs.push({
        whatsappNumber: currentWhatsappNumber,
        copiedNumber: number,
        method: method,
        accountHolder: 'LUCAS JOS√â',
        timestamp: timestamp,
        source: 'sketchiware',
        sessionId: currentSessionId
      });
      
      // Manter apenas os √∫ltimos 50 registros
      if (copyLogs.length > 50) {
        copyLogs.splice(0, copyLogs.length - 50);
      }
      
      localStorage.setItem(STORAGE_KEY_COPY_LOGS, JSON.stringify(copyLogs));
      
      // Tentar enviar para Firebase se dispon√≠vel
      if (firebaseAvailable) {
        try {
          firebase.firestore().collection('copy_actions').add({
            whatsappNumber: currentWhatsappNumber,
            copiedNumber: number,
            method: method,
            accountHolder: 'LUCAS JOS√â',
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            source: 'sketchiware',
            sessionId: currentSessionId
          });
        } catch (firebaseError) {
          console.warn('‚ö†Ô∏è Firebase falhou na c√≥pia');
        }
      }
      
      console.log(`üìã A√ß√£o copiada: ${method} - ${number}`);
    } catch (error) {
      console.error('‚ùå Erro ao logar c√≥pia:', error);
    }
  }

  // ==================== SELECIONAR M√âTODO DE PAGAMENTO ====================
  function selectPaymentMethod(method) {
    selectedPaymentMethod = method;
    selectedMethodInput.value = method;
    
    // Registrar sele√ß√£o de m√©todo
    registerUserAction('payment_method_selected', {
      method: method
    });
    
    // Remover sele√ß√£o anterior
    document.querySelectorAll('.method-option').forEach(option => {
      option.classList.remove('selected');
    });
    
    // Adicionar sele√ß√£o atual
    const selectedElement = document.getElementById(`method${method.charAt(0).toUpperCase() + method.slice(1)}`);
    if (selectedElement) {
      selectedElement.classList.add('selected');
    }
    
    // Atualizar verifica√ß√£o
    updateMethodCheck();
    validateConfirmationForm();
  }

  // ==================== ATUALIZAR VERIFICA√á√ïES ====================
  function updateMethodCheck() {
    if (selectedPaymentMethod) {
      methodCheck.className = 'fas fa-check-circle valid';
      methodCheck.style.color = 'var(--success)';
    } else {
      methodCheck.className = 'fas fa-check-circle invalid';
      methodCheck.style.color = 'var(--gray-300)';
    }
  }

  function updateMessageCheck(hasValidMessage) {
    if (hasValidMessage) {
      messageCheck.className = 'fas fa-check-circle valid';
      messageCheck.style.color = 'var(--success)';
    } else {
      messageCheck.className = 'fas fa-check-circle invalid';
      messageCheck.style.color = 'var(--gray-300)';
    }
  }

  // ==================== VALIDAR FORMUL√ÅRIO DE CONFIRMA√á√ÉO ====================
  function validateConfirmationForm() {
    const message = transactionMessageInput.value.trim();
    const hasValidMessage = message.length >= 100;
    const hasMethod = selectedPaymentMethod !== '';
    const hasWhatsapp = isWhatsappValid;
    
    // Atualizar √≠cones de verifica√ß√£o
    updateMethodCheck();
    updateMessageCheck(hasValidMessage);
    
    // Validar: Precisa de WhatsApp + M√©todo + Mensagem
    const isValid = hasWhatsapp && hasMethod && hasValidMessage;
    
    submitPaymentBtn.disabled = !isValid;
    
    if (!hasWhatsapp) {
      submitPaymentBtn.title = "Digite seu WhatsApp primeiro";
    } else if (!hasMethod) {
      submitPaymentBtn.title = "Selecione o m√©todo de pagamento";
    } else if (!hasValidMessage) {
      submitPaymentBtn.title = "Informe a mensagem de confirma√ß√£o (100+ caracteres)";
    } else {
      submitPaymentBtn.title = "Clique para enviar confirma√ß√£o";
    }
    
    return isValid;
  }

  // ==================== ENVIAR CONFIRMA√á√ÉO DE PAGAMENTO ====================
  async function submitPaymentConfirmation() {
    // Validar WhatsApp
    if (!isWhatsappValid) {
      showToast('Digite seu WhatsApp primeiro!', 'error');
      whatsappInput.focus();
      return;
    }
    
    // Validar m√©todo selecionado
    if (!selectedPaymentMethod) {
      showToast('Selecione o m√©todo de pagamento!', 'error');
      return;
    }
    
    // Validar que tem mensagem
    const message = transactionMessageInput.value.trim();
    const hasValidMessage = message.length >= 100;
    
    if (!hasValidMessage) {
      showToast('Informe a mensagem de confirma√ß√£o (100+ caracteres)!', 'error');
      return;
    }
    
    const btnText = submitPaymentBtn.querySelector('.btn-text');
    const spinner = submitPaymentBtn.querySelector('.spinner');
    const originalText = btnText.textContent;
    
    btnText.textContent = 'ENVIANDO...';
    spinner.classList.remove('hidden');
    submitPaymentBtn.disabled = true;
    
    // Registrar in√≠cio do envio
    registerUserAction('confirmation_submit_started', {
      method: selectedPaymentMethod,
      messageLength: message.length,
      whatsapp: currentWhatsappNumber
    });
    
    try {
      // Extrair poss√≠vel ID da transa√ß√£o da mensagem
      let extractedTransactionId = 'N√£o identificado';
      if (message.length > 0) {
        // Tentar encontrar padr√µes comuns de ID
        const idPatterns = [
          /ID[:\s]*([A-Z0-9]{8,})/i,
          /Refer√™ncia[:\s]*([A-Z0-9]{8,})/i,
          /Transa√ß√£o[:\s]*([A-Z0-9]{8,})/i,
          /([A-Z][0-9]{9,})/,
          /([0-9]{10,})/
        ];
        
        for (const pattern of idPatterns) {
          const match = message.match(pattern);
          if (match && match[1]) {
            extractedTransactionId = match[1];
            break;
          }
        }
        
        // Se n√£o encontrou, pegar primeiros 20 caracteres
        if (extractedTransactionId === 'N√£o identificado') {
          extractedTransactionId = message.substring(0, 20) + '...';
        }
      }
      
      // Preparar dados
      const paymentData = {
        whatsappNumber: currentWhatsappNumber,
        paymentMethod: selectedPaymentMethod,
        transactionMessage: message,
        transactionId: extractedTransactionId,
        messageLength: message.length,
        timestamp: new Date().toISOString(),
        status: 'pending_verification',
        amount: '659 MT',
        sessionId: currentSessionId
      };
      
      // Salvar localmente
      savePaymentConfirmation(paymentData);
      
      // Registrar envio bem-sucedido localmente
      registerUserAction('confirmation_submit_local', {
        method: selectedPaymentMethod,
        transactionId: extractedTransactionId,
        messageLength: message.length
      });
      
      // Enviar para Firebase se dispon√≠vel
      if (firebaseAvailable) {
        try {
          await firebase.firestore().collection('payment_confirmations').add({
            ...paymentData,
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            source: 'sketchiware'
          });
          console.log('‚úÖ Confirma√ß√£o enviada para Firebase');
          
          // Registrar envio bem-sucedido no Firebase
          registerUserAction('confirmation_submit_firebase', {
            method: selectedPaymentMethod,
            transactionId: extractedTransactionId
          });
        } catch (firebaseError) {
          console.warn('‚ö†Ô∏è Firebase falhou, salvando apenas localmente');
          registerUserAction('confirmation_submit_firebase_error', {
            error: firebaseError.message
          });
        }
      }
      
      // Mostrar modal de confirma√ß√£o
      showConfirmationModal(paymentData);
      
      // Resetar formul√°rio
      resetConfirmationForm();
      
    } catch (error) {
      console.error('‚ùå Erro ao enviar confirma√ß√£o:', error);
      showToast('Erro ao enviar confirma√ß√£o!', 'error');
      
      // Registrar erro no envio
      registerUserAction('confirmation_submit_error', {
        error: error.message,
        method: selectedPaymentMethod
      });
    } finally {
      btnText.textContent = originalText;
      spinner.classList.add('hidden');
      submitPaymentBtn.disabled = false;
    }
  }

  // ==================== SALVAR CONFIRMA√á√ÉO LOCALMENTE ====================
  function savePaymentConfirmation(paymentData) {
    try {
      const payments = JSON.parse(localStorage.getItem(STORAGE_KEY_PAYMENTS) || '[]');
      
      payments.push(paymentData);
      
      // Manter apenas os √∫ltimos 20 registros
      if (payments.length > 20) {
        payments.splice(0, payments.length - 20);
      }
      
      localStorage.setItem(STORAGE_KEY_PAYMENTS, JSON.stringify(payments));
      
      console.log('‚úÖ Confirma√ß√£o salva localmente:', paymentData.transactionId);
      return true;
    } catch (error) {
      console.error('‚ùå Erro ao salvar confirma√ß√£o:', error);
      return false;
    }
  }

  // ==================== MOSTRAR MODAL DE CONFIRMA√á√ÉO ====================
  function showConfirmationModal(paymentData) {
    // Atualizar informa√ß√µes no modal
    modalWhatsappNumber.textContent = `+258${paymentData.whatsappNumber}`;
    modalTransactionId.textContent = paymentData.transactionId || 'N√£o identificado';
    
    // Mostrar modal
    confirmationModal.style.display = 'flex';
    
    // Desabilitar scroll do body
    document.body.style.overflow = 'hidden';
    
    // Registrar visualiza√ß√£o do modal
    registerUserAction('confirmation_modal_viewed', {
      transactionId: paymentData.transactionId
    });
  }

  // ==================== FECHAR MODAL ====================
  function closeModal() {
    confirmationModal.style.display = 'none';
    document.body.style.overflow = 'auto';
    
    // Registrar fechamento do modal
    registerUserAction('confirmation_modal_closed');
  }

  // ==================== RESETAR FORMUL√ÅRIO ====================
  function resetConfirmationForm() {
    // Desmarcar m√©todo
    document.querySelectorAll('.method-option').forEach(option => {
      option.classList.remove('selected');
    });
    selectedPaymentMethod = '';
    selectedMethodInput.value = '';
    
    // Limpar mensagem
    transactionMessageInput.value = '';
    charCount.textContent = '0/100 caracteres m√≠nimos';
    charCount.style.color = 'var(--danger)';
    
    // Atualizar verifica√ß√£o
    updateMethodCheck();
    updateMessageCheck(false);
    
    validateConfirmationForm();
  }

  // ==================== COPIAR N√öMERO DO SUPORTE ====================
  async function copySupportNumber() {
    const supportNumber = '+258866890298';
    
    // Registrar tentativa de c√≥pia do suporte
    registerUserAction('support_copy_attempt');
    
    try {
      await navigator.clipboard.writeText(supportNumber);
      showToast('‚úÖ N√∫mero do suporte copiado!', 'success');
      
      // Registrar c√≥pia bem-sucedida
      registerUserAction('support_copy_success');
      
      // Registrar localmente
      logCopyActionLocally(supportNumber, 'support_number');
      
    } catch (error) {
      console.error('Erro ao copiar suporte:', error);
      
      // Fallback
      try {
        const tempInput = document.createElement('input');
        tempInput.value = supportNumber;
        document.body.appendChild(tempInput);
        tempInput.select();
        document.execCommand('copy');
        document.body.removeChild(tempInput);
        showToast('‚úÖ N√∫mero do suporte copiado!', 'success');
      } catch (fallbackError) {
        showToast('‚ùå Erro ao copiar', 'error');
        registerUserAction('support_copy_error', { error: error.message });
      }
    }
  }

  // ==================== MOSTRAR TOAST ====================
  function showToast(message, type = 'success') {
    toastMessage.textContent = message;
    
    if (type === 'success') {
      toastIcon.className = 'fas fa-check-circle';
      toast.style.borderLeftColor = 'var(--success)';
      toastIcon.style.color = 'var(--success)';
    } else if (type === 'error') {
      toastIcon.className = 'fas fa-exclamation-circle';
      toast.style.borderLeftColor = 'var(--danger)';
      toastIcon.style.color = 'var(--danger)';
    } else if (type === 'warning') {
      toastIcon.className = 'fas fa-exclamation-triangle';
      toast.style.borderLeftColor = 'var(--warning)';
      toastIcon.style.color = 'var(--warning)';
    }
    
    toast.style.display = 'block';
    
    // Registrar toast exibido
    registerUserAction('toast_shown', {
      type: type,
      message: message
    });
    
    // Esconder ap√≥s 3.5s
    setTimeout(() => {
      toast.style.display = 'none';
    }, 3500);
  }

  // ==================== AUTO-SAVE ====================
  setInterval(() => {
    if (isWhatsappValid && currentWhatsappNumber) {
      saveToLocalStorage(currentWhatsappNumber, 'auto_save');
      console.log('üíæ Auto-save realizado');
    }
  }, 30000);

  // ==================== PREVENIR ENVIO DE FORMUL√ÅRIO ====================
  document.addEventListener('submit', function(e) {
    e.preventDefault();
    return false;
  });

  // ==================== REGISTRAR SCROLL ====================
  let lastScrollReport = 0;
  window.addEventListener('scroll', function() {
    const now = Date.now();
    if (now - lastScrollReport > 5000) { // Reportar a cada 5 segundos
      const scrollPercent = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
      if (scrollPercent > 25 && scrollPercent < 100) {
        registerUserAction('page_scroll', {
          scrollPercent: Math.round(scrollPercent),
          viewportHeight: window.innerHeight,
          totalHeight: document.body.scrollHeight
        });
        lastScrollReport = now;
      }
    }
  });

</script>

</body>
</html>